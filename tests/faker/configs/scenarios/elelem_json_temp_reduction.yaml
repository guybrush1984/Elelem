scenario: "elelem_json_temp_reduction"
description: "Test Elelem's JSON temperature reduction retry logic for schema validation errors"
type: "conditional"

models:
  "json-temp-test":
    provider: faker
    capabilities:
      supports_json_mode: true
      supports_temperature: true
      supports_system: true

conditions:
  # High temperature (>0.8) - return valid JSON but missing required field
  # This triggers schema validation error (not parse error) allowing temperature reduction
  - check: "temperature_above"
    value: 0.8
    response:
      type: "success"
      json_data:
        # Missing "status" field that schema requires
        message: "High temperature response"
        partial: true

  # Medium temperature (>0.6) - still return invalid schema JSON
  - check: "temperature_above"
    value: 0.6
    response:
      type: "success"
      json_data:
        # Missing "status" field that schema requires
        message: "Medium temperature response"
        partial: true

  # Low temperature (<=0.6) - return valid JSON matching schema
  - check: "json_mode"
    response:
      type: "success"
      json_data:
        status: "success_after_temperature_reduction"
        final_temperature: "low"
        message: "Valid JSON returned after temperature was reduced"
        retry_successful: true

default_response:
  type: "success"
  content: "Non-JSON mode response"